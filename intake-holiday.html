<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Holiday & Event (Indoor) Intake ‚Äì The Finishing Touch</title>

  <!-- Fonts + Site CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Manrope:wght@400;600&family=Allura&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />

  <style>
    body{background:#fbf8f4}
    .intake-wrap{width:min(920px,92%);margin:28px auto 60px;background:#fff;padding:28px 24px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .intake-title{text-align:center;font-family:"Playfair Display",serif;margin:6px 0 2px}
    .intake-script{text-align:center;font-family:"Allura",cursive;font-size:2rem;margin:0 0 12px;color:#524a46}
    .intake-note{max-width:760px;margin:0 auto 18px;text-align:center;opacity:.9}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .grid-1{display:grid;gap:14px}
    .fieldset{border-top:1px solid #e8ddd1;margin-top:16px;padding-top:16px}
    .submit-row{text-align:center;margin-top:16px}
    .mini-bar{width:min(920px,92%);margin:12px auto 0;text-align:center}
    .hint{font-size:.92rem;opacity:.9}
    .muted{opacity:.85}

    /* Dropdown bits (light) */
    .quote-dropdown{position:relative;display:inline-block}
    .quote-button, .btn.btn-solid{cursor:pointer}
    .quote-menu{
      position:absolute; right:0; top:calc(100% + 6px);
      background:#fff; border:1px solid #e8ddd1; border-radius:10px;
      box-shadow:0 10px 30px rgba(0,0,0,.06);
      padding:8px; min-width:220px; display:none; z-index:50;
    }
    .quote-menu a{display:block; padding:10px 12px; border-radius:8px; color:#2a2624; text-decoration:none}
    .quote-menu a:hover{background:#f3ece6}
    .quote-dropdown.open .quote-menu{display:block}

    .hidden { display:none!important; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <a href="client.html" class="brand-link">
          <span class="vase-logo" aria-hidden="true"></span>
          <span class="brand-name">The Finishing Touch</span>
        </a>
      </div>
      <nav class="main-nav">
        <a href="client.html">Client Portal</a>
        <a href="intake-cleaning.html">Cleaning</a>
        <a href="intake-organizing.html">Organizing</a>
        <a href="intake-decor.html">Interior Decorating</a>
        <a href="intake-holiday.html" class="active">Holiday & Event (Indoor)</a>

        <div class="quote-dropdown" id="quoteDropdown">
          <button class="btn btn-solid" id="quoteBtn" aria-expanded="false" aria-controls="quoteMenu">
            Get Your Quote ‚ñæ
          </button>
          <div class="quote-menu" id="quoteMenu" role="menu" aria-hidden="true">
            <a role="menuitem" href="intake-cleaning.html">Cleaning</a>
            <a role="menuitem" href="intake-organizing.html">Organizing</a>
            <a role="menuitem" href="intake-decor.html">Interior Decorating</a>
            <a role="menuitem" href="intake-holiday.html">Holiday & Event (Indoor)</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="mini-bar">
    <a class="btn btn-outline" href="client.html">‚Üê Back to Client Portal</a>
  </div>

  <main class="intake-wrap">
    <h1 class="intake-title">The Finishing Touch</h1>
    <div class="intake-script">Holiday & Event Decorating Intake (Indoor)</div>
    <p class="intake-note">
      Tell us what you‚Äôre celebrating! We‚Äôll show an instant ballpark <strong>install</strong> estimate below
      (teardown optional). When ready, hit <strong>Create & Book</strong>‚Äîwe‚Äôll post the job for our pros and
      send you to the calendar.
    </p>

    <form id="intakeFormHoliday" class="grid-1" novalidate>
      <!-- Contact -->
      <div class="grid-2">
        <label>Full Name<input name="name" autocomplete="name" required></label>
        <label>Email<input name="email" type="email" autocomplete="email" required></label>
        <label>Service Address<input name="address" autocomplete="street-address"></label>
        <label>Phone<input name="phone" type="tel" autocomplete="tel"></label>
      </div>

      <!-- Occasion -->
      <div class="fieldset grid-2">
        <label>Occasion / Holiday
          <select name="occasion" id="occasionSelect" required>
            <option value="">Select an occasion</option>

            <optgroup label="Winter">
              <option>New Year‚Äôs Day</option>
              <option>Valentine‚Äôs Day</option>
              <option>Galentine‚Äôs Party</option>
            </optgroup>

            <optgroup label="Spring">
              <option>St. Patrick‚Äôs Day</option>
              <option>Easter</option>
              <option>Mother‚Äôs Day</option>
              <option>Graduation</option>
            </optgroup>

            <optgroup label="Summer">
              <option>Memorial Day</option>
              <option>Juneteenth</option>
              <option>4th of July</option>
              <option>Back to School</option>
              <option>Labor Day</option>
            </optgroup>

            <optgroup label="Fall">
              <option>Halloween</option>
              <option>Thanksgiving</option>
            </optgroup>

            <optgroup label="Winter Holidays">
              <option>Hanukkah</option>
              <option>Christmas</option>
              <option>New Year‚Äôs Eve</option>
            </optgroup>

            <optgroup label="Events & Parties">
              <option>Birthday</option>
              <option>Baby Shower</option>
              <option>Bridal Shower</option>
              <option>Engagement</option>
              <option>Anniversary</option>
              <option>Retirement</option>
              <option>Game Day / Super Bowl</option>
              <option value="Custom">Other / Custom‚Ä¶</option>
            </optgroup>
          </select>
        </label>

        <label id="occasionCustomWrap" style="display:none">What‚Äôs the occasion?
          <input name="occasion_custom" id="occasionCustom" placeholder="e.g., Quincea√±era, Diwali, Mardi Gras">
        </label>

        <label>Decor style vibe
          <select name="vibe">
            <option>Classic & cozy</option>
            <option>Modern & minimal</option>
            <option>Bold & colorful</option>
            <option>Neutral & natural</option>
          </select>
        </label>
      </div>

      <!-- Scope -->
      <div class="fieldset grid-2">
        <!-- Tree cluster (auto hidden unless Christmas) -->
        <div class="grid-2" id="treeCluster">
          <label>Number of Trees
            <input name="trees" id="trees" type="number" min="0" value="1">
          </label>
          <label>Tallest Tree Size
            <select name="tallest" id="tallest">
              <option>‚â§6 ft</option><option selected>7‚Äì8 ft</option>
              <option>9‚Äì10 ft</option><option>11‚Äì12+ ft</option>
            </select>
          </label>
          <label>Tree Style / Approach
            <select name="tree_style" id="tree_style">
              <option selected>Ready: ornaments & lights on hand</option>
              <option>Needs ribbon/theme refresh</option>
              <option>Full design + sourcing</option>
            </select>
          </label>
          <label>Use ribbon/mesh on tree?
            <select name="tree_ribbon" id="tree_ribbon"><option>No</option><option>Yes</option></select>
          </label>
          <div class="grid-1" style="grid-column:1/-1">
            <span class="muted">Tree fields are hidden for non-Christmas occasions.</span>
          </div>
        </div>

        <label>Wreaths (count)
          <input name="wreaths" type="number" min="0" value="0">
        </label>
        <label>Garland Sections (mantle/rail/doorways)
          <input name="garland_sections" type="number" min="0" value="0">
        </label>

        <label>Stair/Railing Sections
          <input name="stair_sections" type="number" min="0" value="0">
        </label>
        <label>Decorate Mantle?
          <select name="mantle"><option>No</option><option>Yes</option></select>
        </label>

        <label>Tablescapes / Vignettes (count)
          <input name="tablescapes" type="number" min="0" value="0">
        </label>
        <label>Storage Access
          <select name="storage">
            <option>Garage/closet (easy)</option>
            <option>Attic (ladder)</option>
            <option>Offsite pickup</option>
          </select>
        </label>

        <label>Shopping Trips Needed
          <select name="shopping_trips">
            <option>0</option><option>1</option><option>2</option><option>3+</option></select>
        </label>
        <label>Include Teardown?
          <select name="teardown"><option>Yes</option><option selected>No</option></select>
        </label>

        <label style="grid-column:1/-1">Notes / Special Requests
          <input name="notes" placeholder="colors, themes, fragile items, access notes">
        </label>

        <label>Payment Preference
          <select name="pay"><option>Zelle</option><option>Venmo</option><option>Cash App</option><option>Cash</option></select>
        </label>
      </div>

      <!-- Consents -->
      <fieldset class="fieldset grid-1" aria-labelledby="consentLegend">
        <legend id="consentLegend" style="font-weight:700;">Consents</legend>
        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_work_photos" required>
          <span>I allow before/after photos for job verification and quality control (not for marketing unless I also consent below).</span>
        </label>
        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_marketing_photos">
          <span>Okay to use select photos for marketing (no street address/personal items shown). I can revoke in writing.</span>
        </label>
        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_terms" required>
          <span>I agree to the service terms. <a href="terms.html#client-terms" target="_blank" rel="noopener">Read terms</a>.</span>
        </label>
        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_updates">
          <span>Okay to email/SMS me with scheduling & updates.</span>
        </label>
      </fieldset>

      <!-- Submit -->
      <div class="submit-row">
        <button class="btn btn-solid" type="submit">Create & Book</button>
        <p id="estimateHoliday" class="hero-sub" style="color:#524a46;margin-top:10px;"></p>
      </div>
    </form>
  </main>

  <!-- EmailJS (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>/* emailjs.init('YOUR_EMAILJS_PUBLIC_KEY'); */</script>

  <!-- Local dropdown behavior -->
  <script>
    (function(){
      const dd = document.getElementById('quoteDropdown');
      const btn= document.getElementById('quoteBtn');
      const menu=document.getElementById('quoteMenu');
      if (!dd || !btn || !menu) return;
      const toggle = (open)=>{ dd.classList.toggle('open', open); btn.setAttribute('aria-expanded', String(open)); menu.setAttribute('aria-hidden', String(!open)); };
      btn.addEventListener('click', (e)=>{ e.preventDefault(); toggle(!dd.classList.contains('open')); });
      document.addEventListener('click', (e)=>{ if (!dd.contains(e.target)) toggle(false); });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') toggle(false); });
    })();
  </script>

  <!-- Your site JS (pricing/time calculators) -->
  <script src="script.js?v=8" defer></script>

  <!-- === AUTO-CREATE JOBS (Thumbtack mode) === -->
  <script type="module" src="ft-auto.js"></script>

  <!-- In-page glue: occasion logic + estimate + auto-create + Square handoff -->
  <script type="module">
    import { auth } from "./ft-firebase.js";

    (function(){
      const SQUARE_BOOKING_BASE = "https://book.squareup.com/appointments/kbcbv6uu1d7qd7/location/L2P303Y0SXTD9";

      const treeCluster   = document.getElementById('treeCluster');
      const treesInput    = document.getElementById('trees');
      const occasionSel   = document.getElementById('occasionSelect');
      const occCustomWrap = document.getElementById('occasionCustomWrap');
      const occCustom     = document.getElementById('occasionCustom');

      function currentOccasion(){
        const val = (occasionSel?.value || "").trim();
        if (!val) return "";
        if (val === "Custom") return (occCustom?.value || "").trim();
        return val;
      }

      function showTrees(yes){
        if (yes){ treeCluster.classList.remove('hidden'); }
        else {
          treeCluster.classList.add('hidden');
          if (treesInput) treesInput.value = 0;
        }
      }
      function updateTreeVisibility(){
        const occ = currentOccasion().toLowerCase();
        // Only Christmas uses trees; Game Day / Birthday / etc. do not.
        showTrees(occ.includes('christmas'));
      }
      function toggleOccasionCustom(){
        const isCustom = occasionSel && (occasionSel.value === "Custom");
        occCustomWrap.style.display = isCustom ? "" : "none";
        if (!isCustom) occCustom.value = "";
        updateTreeVisibility();
      }

      function labelFromHours(teamHours, occasionLabel){
        const occ = occasionLabel ? ` ‚Äî ${occasionLabel}` : "";
        if (teamHours <= 2.5) return `Holiday & Event (indoor${occ}) ‚Äî Small (‚âà2‚Äì2.5 hr)`;
        if (teamHours <= 4)   return `Holiday & Event (indoor${occ}) ‚Äî Medium (‚âà3‚Äì4 hr)`;
        if (teamHours <= 6)   return `Holiday & Event (indoor${occ}) ‚Äî Large (‚âà5‚Äì6 hr)`;
        return `Holiday & Event (indoor${occ}) ‚Äî XL (6.5+ hr)`;
      }

      document.addEventListener('DOMContentLoaded', () => {
        toggleOccasionCustom();
        occasionSel?.addEventListener('change', toggleOccasionCustom);
        occCustom?.addEventListener('input', updateTreeVisibility);

        const formHol = document.getElementById('intakeFormHoliday');
        if (!formHol) return;

        formHol.addEventListener('submit', async (e)=>{
          e.preventDefault();
          e.stopImmediatePropagation();

          const data = Object.fromEntries(new FormData(formHol).entries());
          data.occasion = currentOccasion();
          data.occasion_custom = occCustom?.value || "";

          // Run your public calculator
          let res = { price:0, soloHours:0, teamHours:0, teardownHours:0, teardownPrice:0 };
          try {
            if (typeof calcHoliday === 'function') {
              res = calcHoliday(data);
            }
          } catch(err){ console.warn("Holiday estimate error:", err); }

          // Show estimate inline for transparency
          const estEl = document.getElementById('estimateHoliday');
          const parts = [
            `Install (ballpark): <strong>$${res.price}</strong>`,
            `Estimated time: ${res.soloHours} solo hrs (~${res.teamHours} hrs with 2 stylists)`
          ];
          if (res.teardownHours){
            parts.push(`Teardown (optional): ~${res.teardownHours} hrs ‚Ä¢ approx <strong>$${res.teardownPrice}</strong>`);
          }
          parts.push(`<span class="hint">Materials (ribbon/ornaments/garland/props) are separate and billed to your budget.</span>`);
          estEl.innerHTML = parts.join("<br>");

          // Require login ‚Üí bounce to auth then back here
          if (!auth.currentUser){
            const next = encodeURIComponent(location.pathname);
            location.href = `login.html?next=${next}`;
            return;
          }

          // Post job automatically (Thumbtack style)
          try{
            const jobId = await window.FTAuto.createJobFromIntake({
              type: "holiday",
              intakeData: data,
              estimate: {
                price: res.price,
                teamHours: res.teamHours,
                teardownPrice: res.teardownPrice,
                teardownHours: res.teardownHours
              },
              windowHint: "This week (flexible)"
            });
            if (!jobId) return;

            // Send client to Square to pick a slot
            location.href = SQUARE_BOOKING_BASE;
          } catch (eCreate){
            console.warn(eCreate);
            estEl.innerHTML += `<br><span class="hint" style="color:#7f1d1d">We couldn't create your job automatically. Please try again in a moment.</span>`;
          }
        }, true);
      });
    })();
  </script>

  <!-- Chat (unchanged) -->
  <div id="ftt-chat-launcher" aria-label="Open chat" role="button">üí¨</div>
  <div id="ftt-chat" aria-live="polite" aria-label="Chat window" hidden>
    <div class="ftt-chat-header">
      <div>
        <div class="ftt-title">The Finishing Touch</div>
        <div class="ftt-subtitle">AI Concierge ‚Ä¢ human on request</div>
      </div>
      <button class="ftt-close" aria-label="Close chat">√ó</button>
    </div>
    <div id="ftt-thread" class="ftt-thread"></div>
    <form id="ftt-inputbar" class="ftt-inputbar" autocomplete="off">
      <input id="ftt-input" name="message" type="text" placeholder="Ask about pricing, availability, services‚Ä¶" aria-label="Type your message" required />
      <button class="ftt-send" type="submit">Send</button>
    </form>
    <div class="ftt-quick">
      <button data-q="pricing">Pricing</button>
      <button data-q="availability">Availability</button>
      <button data-q="services">Services</button>
      <button data-q="book">Book now</button>
      <button data-q="human">Talk to a person</button>
      <button data-q="help">Help me choose</button>
    </div>
  </div>
  <script>
    (function(){
      const C={timezone:"America/Chicago",intakeAnchor:"intake-holiday.html",bookUrl:"https://book.squareup.com/appointments/kbcbv6uu1d7qd7/location/L2P303Y0SXTD9",email:"contact.thefinishingtouch.tx@gmail.com",messengerDeepLink:"https://m.me/thefinishingtouch.tx",hours:{days:[1,2,3,4,5],open:"09:00",close:"17:00"}};
      const el={launcher:document.getElementById("ftt-chat-launcher"),panel:document.getElementById("ftt-chat"),thread:document.getElementById("ftt-thread")};
      function add(html,who="bot"){const b=document.createElement("div");b.className=`ftt-bubble ${who}`;b.innerHTML=html;el.thread.appendChild(b);el.thread.scrollTop=el.thread.scrollHeight;}
      function greet(){add("Hi! I‚Äôm your AI concierge. Ask me about holiday decorating, pricing, or availability. Say ‚Äúhuman‚Äù anytime.","bot");}
      function intent(t){t=t.toLowerCase();if(/human|person|agent|representative|someone|call|talk/.test(t))return"human";if(/price|pricing|cost|rate|how much/.test(t))return"pricing";if(/avail|slot|appointment|when|schedule|open/.test(t))return"availability";if(/service|decor|holiday/.test(t))return"services";if(/book|booking/.test(t))return"book";if(/which|help choose|recommend|not sure|what should i (pick|choose)|suggest/.test(t))return"recommend";return"fallback";}
      function ans(i){const intake=`<a href="${C.intakeAnchor}">Start Intake</a>`,book=`<a href="${C.bookUrl}" target="_blank" rel="noopener">Book now</a>`;switch(i){case"pricing":return["Indoor holiday installs are billed by time; your intake shows a tailored ballpark with optional teardown.",intake+" ‚Ä¢ or "+book].join("<br>");case"availability":return["Availability is live in Square.",book+" to see openings, or "+intake+" first."].join("<br>");case"services":return["Indoor trees (when Christmas), mantles, stairs, wreaths, garlands, tablescapes. Outdoor installs currently unavailable.","Start here: "+intake+" ‚Ä¢ Or jump to "+book+"."].join("<br>");case"book":return"Perfect‚Äî"+book+" (opens in a new tab), or "+intake+" for a tailored estimate first.";case"human":return`Tap <a href="${C.messengerDeepLink}" target="_blank" rel="noopener">Message us on Facebook</a> or email <a href="mailto:${C.email}">${C.email}</a>.`;case"recommend":return["<strong>Happy to help!</strong> Small: single tree or accent set. Medium: tree + mantle/rail. Large: multiple areas or extra sourcing.",`Ready to book? ${book} (new tab). Or ${intake} first.`].join("<br>");default:return["I can help with pricing, availability, and services.","Try ‚Äúwhat‚Äôs your pricing?‚Äù or ‚Äúdo you have Friday slots?‚Äù","Say ‚Äúhuman‚Äù to talk to a person."].join("<br>");}}
      function init(){const close=document.querySelector(".ftt-close"),panel=document.getElementById("ftt-chat"),form=document.getElementById("ftt-inputbar"),input=document.getElementById("ftt-input"),quick=document.querySelector(".ftt-quick");el.launcher.addEventListener("click",()=>{panel.hidden=false;if(!el.thread.dataset.greeted){greet();el.thread.dataset.greeted="1";}input.focus();});close.addEventListener("click",()=>{panel.hidden=true;});form.addEventListener("submit",e=>{e.preventDefault();const t=input.value.trim();if(!t)return;add(t,"me");input.value="";setTimeout(()=>add(ans(intent(t)),"bot"),200);});quick.addEventListener("click",e=>{if(e.target.matches("button[data-q]")){const map={pricing:"pricing",availability:"availability",services:"services",book:"book",human:"human",help:"recommend"};const i=map[e.target.getAttribute("data-q")]||"fallback";add(e.target.textContent,"me");setTimeout(()=>add(ans(i),"bot"),200);}});}
      document.addEventListener("DOMContentLoaded",init);
    })();
  </script>
</body>
</html>

