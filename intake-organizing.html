<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Organizing Intake – The Finishing Touch</title>

  <!-- Fonts + Site CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Manrope:wght@400;600&family=Allura&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />

  <style>
    body{background:#fbf8f4}
    .intake-wrap{width:min(920px,92%);margin:28px auto 60px;background:#fff;padding:28px 24px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .intake-title{text-align:center;font-family:"Playfair Display",serif;margin:6px 0 2px}
    .intake-script{text-align:center;font-family:"Allura",cursive;font-size:2rem;margin:0 0 12px;color:#524a46}
    .intake-note{max-width:760px;margin:0 auto 18px;text-align:center;opacity:.9}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .grid-1{display:grid;gap:14px}
    .fieldset{border-top:1px solid #e8ddd1;margin-top:16px;padding-top:16px}
    .submit-row{text-align:center;margin-top:16px}
    .hint{font-size:.95rem; opacity:.9}

    .quote-dropdown{position:relative;display:inline-block}
    .quote-button, .btn.btn-solid{cursor:pointer}
    .quote-menu{
      position:absolute; right:0; top:calc(100% + 6px);
      background:#fff; border:1px solid #e8ddd1; border-radius:10px;
      box-shadow:0 10px 30px rgba(0,0,0,.06);
      padding:8px; min-width:220px; display:none; z-index:50;
    }
    .quote-menu a{display:block; padding:10px 12px; border-radius:8px; color:#2a2624; text-decoration:none}
    .quote-menu a:hover{background:#f3ece6}
    .quote-dropdown.open .quote-menu{display:block}

    .mini-bar{width:min(920px,92%);margin:12px auto 0;text-align:center}

    /* Success card */
    .success-card{
      margin-top:14px;
      background:#fbf5ee;
      border:1px solid #ecdccc;
      border-radius:14px;
      padding:14px 16px;
      font-size:.98rem;
      display:none;
      text-align:center;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <a href="client.html" class="brand-link">
          <span class="vase-logo" aria-hidden="true"></span>
          <span class="brand-name">The Finishing Touch</span>
        </a>
      </div>
      <nav class="main-nav">
        <a href="client.html">Client Portal</a>
        <div class="quote-dropdown" id="quoteDropdown">
          <button class="btn btn-solid" id="quoteBtn" aria-expanded="false" aria-controls="quoteMenu">
            Get Your Quote ▾
          </button>
          <div class="quote-menu" id="quoteMenu" role="menu" aria-hidden="true">
            <a role="menuitem" href="intake-cleaning.html">Cleaning</a>
            <a role="menuitem" href="intake-organizing.html">Organizing</a>
            <a role="menuitem" href="intake-decor.html">Interior Decorating</a>
            <a role="menuitem" href="intake-holiday.html">Holiday Decorating (Indoor)</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="mini-bar">
    <a class="btn btn-outline" href="client.html">← Back to Client Portal</a>
  </div>

  <main class="intake-wrap">
    <h1 class="intake-title">The Finishing Touch</h1>
    <div class="intake-script">Organizing Intake Form</div>

    <p class="intake-note">
      Complete this brief intake so we can review your project and follow up with a ballpark range and recommended approach.
      Uploading photos/video (optional) helps us quote accurately.
    </p>

    <!-- Formspree (paid uploads enabled) -->
    <form id="intakeFormOrganizing" class="grid-1" method="POST" action="https://formspree.io/f/mzzaogbv" enctype="multipart/form-data" novalidate>
      <input type="hidden" name="_subject" value="New Organizing Intake · The Finishing Touch" />
      <input type="hidden" name="page" value="intake-organizing.html" />

      <!-- Contact -->
      <div class="grid-2">
        <label>Full Name<input name="name" autocomplete="name" required></label>
        <label>Email<input name="email" type="email" autocomplete="email" required></label>
        <label>Service Address<input name="address" autocomplete="street-address"></label>
        <label>Phone<input name="phone" type="tel" autocomplete="tel"></label>
      </div>

      <!-- Session Type + Goals -->
      <div class="fieldset grid-2">
        <label>Organizing Service Type
          <select name="org_service_type" required>
            <option value="Not sure" selected>Not sure (recommend for me)</option>
            <option value="Light">Light Organizing (small spaces)</option>
            <option value="WholeHome">Whole-Home Organizing (multi-space / deeper reset)</option>
          </select>
        </label>

        <label>Primary Goal
          <select name="org_goal" required>
            <option value="Reset" selected>Reset + simple systems</option>
            <option value="Declutter">Declutter + donate + deeper reset</option>
            <option value="Unpack">Unpack + set up systems</option>
            <option value="Maintenance">Maintenance / refresh of an existing system</option>
          </select>
        </label>
      </div>

      <!-- Scope (Interior Only) -->
      <div class="fieldset grid-2">
        <label>Primary Area (Interior Only)
          <select name="org_area" required>
            <option>Pantry</option>
            <option>Kitchen</option>
            <option>Closet</option>
            <option>Bedroom</option>
            <option>Bathroom</option>
            <option>Laundry Room</option>
            <option>Office</option>
            <option>Playroom</option>
            <option>Multiple Areas (interior)</option>
            <option>Whole Home (interior multi-area)</option>
          </select>
        </label>

        <label>Approx. Home Size (sq ft)
          <select name="home_sqft">
            <option value="">Prefer not to say</option>
            <option>Under 1,500</option>
            <option>1,500–2,500</option>
            <option>2,500–3,500</option>
            <option>3,500–4,500</option>
            <option>4,500+</option>
          </select>
        </label>

        <label>Area Size
          <select name="org_size" required>
            <option>Small</option>
            <option selected>Medium</option>
            <option>Large</option>
          </select>
        </label>

        <label># of Spaces (rooms/areas)
          <input name="spaces" type="number" min="1" value="1" required>
        </label>
      </div>

      <!-- Complexity Drivers -->
      <div class="fieldset grid-2">
        <label>Clutter Level
          <select name="org_clutter" required>
            <option>Light</option>
            <option selected>Moderate</option>
            <option>Heavy</option>
          </select>
        </label>

        <label>Decision Speed (purge/sort)
          <select name="org_decision_speed" required>
            <option>Fast</option>
            <option selected>Average</option>
            <option>Slow</option>
          </select>
        </label>

        <label>Estimated Item Volume
          <select name="org_volume" required>
            <option>Low</option>
            <option selected>Medium</option>
            <option>High</option>
          </select>
        </label>

        <label>Containers Needed (bins/labels)
          <select name="org_containers" required>
            <option selected>None</option>
            <option>Some (up to 10)</option>
            <option>Many (10+)</option>
          </select>
        </label>

        <label>Notes / Focus Areas
          <input name="notes" placeholder="e.g., zones for kids, seasonal storage">
        </label>

        <label>Add-ons (type keywords: bins, labels, sourcing)
          <input name="addons" placeholder="e.g., bins/labels">
        </label>
      </div>

      <!-- Donations Policy -->
      <div class="fieldset grid-1" role="note" aria-live="polite">
        <p class="hint" style="margin:0;">
          <strong>Donations:</strong> We can schedule donation pickup with our preferred donation partner. If you’d like to donate elsewhere, you’ll handle drop-off directly.
          We can bag/box and stage items for pickup.
        </p>
      </div>

      <!-- Media Uploads (Formspree handles uploads) -->
      <div class="fieldset grid-1">
        <p class="hint" style="margin:0 0 8px;">
          <strong>Photos/Video (optional):</strong> Upload 3–10 photos (and an optional short video) to help us quote accurately.
          Best shots: wide view of the space, inside cabinets/closet, and the main problem zones.
        </p>

        <label>Upload Photos (optional)
          <input name="media_photos" id="mediaPhotos" type="file" accept="image/*" multiple>
        </label>

        <label>Upload Video (optional, short)
          <input name="media_video" id="mediaVideo" type="file" accept="video/*">
        </label>

        <p class="hint" id="uploadStatus" style="margin:6px 0 0;"></p>
      </div>

      <!-- Scheduling Preferences -->
      <div class="fieldset grid-2">
        <label>Preferred Session Cadence
          <select name="org_cadence" required>
            <option value="Weekly" selected>Weekly (recommended for larger projects)</option>
            <option value="TwiceWeekly">Twice per week</option>
            <option value="Flexible">Flexible / as available</option>
          </select>
        </label>

        <label>Preferred Days / Times
          <input name="availability" placeholder="e.g., Tue/Thu mornings">
        </label>

        <label>Decision Preference During Session
          <select name="org_style" required>
            <option value="HandsOn" selected>I can be hands-on and make decisions</option>
            <option value="Guided">Guided (you lead; I approve as needed)</option>
            <option value="HandsOff">Mostly hands-off (please follow my guidelines)</option>
          </select>
        </label>

        <label>Payment Preference
          <select name="pay" required>
            <option>Zelle</option><option>Venmo</option><option>Cash App</option><option>Cash</option>
          </select>
        </label>
      </div>

      <!-- Consents -->
      <fieldset class="fieldset grid-1" aria-labelledby="consentLegend">
        <legend id="consentLegend" style="font-weight:700;">Consents</legend>

        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_sms_email" value="Yes" required>
          <span>Okay to contact me by email/SMS with scheduling and project updates.</span>
        </label>

        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_photos_doc" value="Yes" required>
          <span>I consent to before/after photos for job documentation (internal only).</span>
        </label>

        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_photos_marketing" value="Yes">
          <span>I also consent to selected photos being used for marketing (website/social).</span>
        </label>

        <label style="display:flex;gap:.6rem;align-items:flex-start;">
          <input type="checkbox" name="consent_terms" value="Yes" required>
          <span>I agree to the service terms (scheduling, access, cancellation, and safety). <a href="terms.html#client-terms" target="_blank" rel="noopener">Read terms</a>.</span>
        </label>
      </fieldset>

      <!-- Submit -->
      <div class="submit-row">
        <button class="btn btn-solid" type="submit" id="orgSubmitBtn">Submit Organizing Intake</button>
        <p id="emailStatusOrganizing" class="hint"></p>
        <div id="successCard" class="success-card" aria-live="polite"></div>
      </div>
    </form>
  </main>

  <!-- Dropdown behavior -->
  <script>
    (function(){
      const dd  = document.getElementById('quoteDropdown');
      const btn = document.getElementById('quoteBtn');
      const menu= document.getElementById('quoteMenu');
      if (!dd || !btn || !menu) return;
      function toggle(open){
        dd.classList.toggle('open', open);
        btn.setAttribute('aria-expanded', String(open));
        menu.setAttribute('aria-hidden', String(!open));
      }
      btn.addEventListener('click', (e)=>{ e.preventDefault(); toggle(!dd.classList.contains('open')); });
      document.addEventListener('click', (e)=>{ if (!dd.contains(e.target)) toggle(false); });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') toggle(false); });
    })();
  </script>

  <script src="script.js?v=7" defer></script>

  <!-- Internal recommendation engine (emails to YOU only; never shown to client) -->
  <script>
    (function(){
      // === 4-hour session model ===
      const SESSION_HOURS = 4;

      // Client-facing starts (per 4-hour session)
      const LIGHT_SESSION_START = 380;
      const WHOLE_SESSION_START = 520;

      // Sub pay ranges (per hour)
      const SUB_PAY_LIGHT_MIN = 30;
      const SUB_PAY_LIGHT_MAX = 45;
      const SUB_PAY_LARGE_MIN = 45;
      const SUB_PAY_LARGE_MAX = 55;

      const MID = (a,b)=> (Number(a)+Number(b))/2;

      function normalize(v){ return (v||"").toString().trim(); }
      function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
      function roundTo(n, step){ return Math.round(n/step)*step; }
      function ceilTo(n, step){ return Math.ceil(n/step)*step; }

      function isMultiArea(area){
        return /multiple|whole home/i.test(area||"");
      }

      function recommendTier(data){
        const forced = normalize(data.org_service_type);
        const area = normalize(data.org_area).toLowerCase();
        const spaces = Math.max(1, parseInt(data.spaces || "1", 10) || 1);
        const clutter = normalize(data.org_clutter);
        const volume = normalize(data.org_volume);
        const goal = normalize(data.org_goal);

        if (forced === "Light") return "Light";
        if (forced === "WholeHome") return "WholeHome";

        if (isMultiArea(area)) return "WholeHome";
        if (spaces >= 2) return "WholeHome";
        if (clutter === "Heavy" || volume === "High") return "WholeHome";
        if (goal === "Declutter" || goal === "Unpack") return "WholeHome";
        return "Light";
      }

      function estimatePoints(data, tier){
        const area = normalize(data.org_area).toLowerCase();
        const size = normalize(data.org_size) || "Medium";
        const spaces = Math.max(1, parseInt(data.spaces || "1", 10) || 1);

        let base = (tier === "Light") ? 1 : 2;

        if (/kitchen/.test(area)) base += (tier === "Light") ? 1 : 2;
        if (/playroom/.test(area)) base += 1;
        if (/office/.test(area)) base += 1;
        if (/bathroom/.test(area)) base += 0.5;
        if (/bedroom/.test(area)) base += 0.5;
        if (/closet/.test(area)) base += 0.5;
        if (/pantry/.test(area)) base += (tier === "Light") ? 0.5 : 1;

        let mult = 1;
        if (size === "Small") mult *= 0.9;
        if (size === "Large") mult *= 1.25;

        const clutter = normalize(data.org_clutter);
        const volume = normalize(data.org_volume);
        const decision = normalize(data.org_decision_speed);

        if (clutter === "Moderate") mult *= 1.15;
        if (clutter === "Heavy") mult *= 1.35;
        if (volume === "High") mult *= 1.20;
        if (decision === "Slow") mult *= 1.15;

        return spaces * base * mult;
      }

      function pointsToSessions(points){
        if (points <= 1.5) return 1;
        if (points <= 3.25) return 2;
        if (points <= 5.25) return 3;
        if (points <= 7.5) return 4;
        if (points <= 10) return 5;
        if (points <= 13) return 6;
        if (points <= 16) return 7;
        return 8;
      }

      function recommendStaffing(data, tier, sessions){
        const spaces = Math.max(1, parseInt(data.spaces || "1", 10) || 1);
        const clutter = normalize(data.org_clutter);
        const volume = normalize(data.org_volume);
        const decision = normalize(data.org_decision_speed);

        let organizers = 1;
        if (tier === "WholeHome") organizers = 2;
        if (spaces >= 4) organizers = 2;
        if (spaces >= 6) organizers = 3;

        if (clutter === "Heavy" && volume === "High") organizers = Math.max(organizers, 2);
        if (decision === "Slow" && spaces >= 3) organizers = Math.max(organizers, 2);

        organizers = clamp(organizers, 1, 3);

        const cadence = normalize(data.org_cadence) || "Weekly";
        let schedule = "Weekly sessions recommended.";
        if (cadence === "TwiceWeekly") schedule = "Twice per week can accelerate larger projects.";
        if (cadence === "Flexible") schedule = "Flexible scheduling based on availability.";
        if (sessions >= 4) schedule = "Weekly sessions recommended for momentum without burnout (4-hour blocks).";

        return { organizers, schedule };
      }

      function clientBallpark(tier, sessions){
        const perSession = (tier === "Light") ? LIGHT_SESSION_START : WHOLE_SESSION_START;
        const low = perSession * sessions;
        const high = ceilTo(low * 1.15, 10);
        return { perSession, low: roundTo(low, 10), high: roundTo(high, 10) };
      }

      function subFlatFeePerSession(tier, organizers){
        const hourly = (tier === "Light")
          ? MID(SUB_PAY_LIGHT_MIN, SUB_PAY_LIGHT_MAX)
          : MID(SUB_PAY_LARGE_MIN, SUB_PAY_LARGE_MAX);

        const hourlySafe = Number.isFinite(hourly) ? hourly : 0;
        const perOrganizer = hourlySafe * SESSION_HOURS;
        const total = perOrganizer * organizers;

        return {
          hourlyMid: Math.round(hourlySafe),
          perOrganizerFlat: roundTo(perOrganizer, 5),
          totalTeamFlat: roundTo(total, 10)
        };
      }

      function buildInternalNotes(data, tier){
        const notes = [];
        const containers = normalize(data.org_containers);
        const addons = normalize(data.addons).toLowerCase();
        const goal = normalize(data.org_goal);

        notes.push(tier === "Light" ? "Tier: Light Organizing Session" : "Tier: Whole-Home Organizing Session");
        notes.push("Interior organizing only (no garages).");

        if (goal === "Declutter") notes.push("Goal includes decluttering + donation flow—plan decision support.");
        if (goal === "Unpack") notes.push("Goal includes unpacking—confirm zones and any sourcing budget.");
        if (containers !== "None") notes.push("Containers/labels likely—confirm budget and whether you are sourcing or recommending.");
        if (/bin|label|source|sourcing/.test(addons)) notes.push("Client requested bins/labels/sourcing—clarify preferences and budget cap.");

        notes.push("Donations: pickup scheduled with preferred partner; client handles alternate drop-off locations.");

        return notes;
      }

      function computeRecommendation(data){
        const tier = recommendTier(data);
        const pointsRaw = estimatePoints(data, tier);
        const points = Math.round(pointsRaw * 10) / 10;

        const sessions = pointsToSessions(pointsRaw);
        const staffing = recommendStaffing(data, tier, sessions);
        const ballpark = clientBallpark(tier, sessions);
        const subPay = subFlatFeePerSession(tier, staffing.organizers);

        return {
          tier,
          points,
          sessions,
          sessionHours: SESSION_HOURS,
          sessionPlan: `${sessions} session${sessions>1?"s":""} × ${SESSION_HOURS} hours`,
          organizers: staffing.organizers,
          scheduleSuggestion: staffing.schedule,
          clientPerSessionStarting: ballpark.perSession,
          clientBallparkLow: ballpark.low,
          clientBallparkHigh: ballpark.high,
          subHourlyMid: subPay.hourlyMid,
          subFlatPerOrganizer: subPay.perOrganizerFlat,
          subFlatTeamPerSession: subPay.totalTeamFlat,
          internalNotes: buildInternalNotes(data, tier)
        };
      }

      window.__FTT_ORG_REC__ = { computeRecommendation };
    })();
  </script>

  <!-- Submit: Formspree upload + email ops details to YOU (client sees only success message) -->
  <script>
    (function(){
      document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('intakeFormOrganizing');
        if (!form) return;

        const statusEl = document.getElementById('emailStatusOrganizing');
        const submitBtn = document.getElementById('orgSubmitBtn');
        const uploadStatus = document.getElementById('uploadStatus');
        const successCard = document.getElementById('successCard');

        function setUploadHint(){
          const pCount = document.getElementById("mediaPhotos")?.files?.length || 0;
          const vCount = document.getElementById("mediaVideo")?.files?.length || 0;
          if (!uploadStatus) return;
          if (!pCount && !vCount) { uploadStatus.textContent = ""; return; }
          uploadStatus.textContent = `Selected: ${pCount} photo(s)${vCount? " + 1 video": ""}.`;
        }

        document.getElementById("mediaPhotos")?.addEventListener("change", setUploadHint);
        document.getElementById("mediaVideo")?.addEventListener("change", setUploadHint);

        form.addEventListener('submit', async function(e){
          e.preventDefault();
          e.stopImmediatePropagation();

          if (statusEl) statusEl.textContent = "";
          if (successCard) { successCard.style.display = "none"; successCard.textContent = ""; }

          if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = "Submitting…"; }

          const fd = new FormData(form);

          // Build data object (non-file fields) for internal ops rec
          const data = {};
          fd.forEach((v, k) => {
            // keep files in FormData for Formspree upload; but ignore them for math
            if (k === "media_photos" || k === "media_video") return;
            data[k] = v;
          });

          const intakeId = `org_${Date.now()}_${Math.random().toString(16).slice(2)}`;
          fd.append("intake_id", intakeId);

          const rec = window.__FTT_ORG_REC__?.computeRecommendation
            ? window.__FTT_ORG_REC__.computeRecommendation(data)
            : null;

          // Internal-only fields (to your email)
          if (rec){
            fd.append("INTERNAL_recommended_tier", rec.tier === "Light" ? "Light Organizing (4-hour sessions)" : "Whole-Home Organizing (4-hour sessions)");
            fd.append("INTERNAL_sessions", `${rec.sessions} session(s) × ${rec.sessionHours} hours`);
            fd.append("INTERNAL_staffing", `${rec.organizers} organizer(s)`);
            fd.append("INTERNAL_schedule_suggestion", rec.scheduleSuggestion);

            fd.append("INTERNAL_client_ballpark_range", `$${rec.clientBallparkLow} – $${rec.clientBallparkHigh}`);
            fd.append("INTERNAL_per_session_starting", `$${rec.clientPerSessionStarting} per 4-hour session`);

            fd.append("INTERNAL_sub_pay_mid_hourly", `$${rec.subHourlyMid}/hr (midpoint)`);
            fd.append("INTERNAL_sub_flat_per_organizer_per_session", `$${rec.subFlatPerOrganizer} (4 hours)`);
            fd.append("INTERNAL_sub_flat_team_per_session", `$${rec.subFlatTeamPerSession} total team flat`);

            fd.append("INTERNAL_complexity_score", String(rec.points));
            fd.append("INTERNAL_notes", (rec.internalNotes || []).join(" | "));
          }

          // Send to Formspree (AJAX). Do NOT set Content-Type manually.
          try{
            const resp = await fetch(form.action, {
              method: 'POST',
              headers: { 'Accept': 'application/json' },
              body: fd
            });

            if (resp.ok){
              if (statusEl) statusEl.textContent = "";
              if (successCard){
                successCard.textContent =
                  "Thanks! We’ve received your intake. We’ll review your details and follow up with a ballpark range and recommended approach.";
                successCard.style.display = "block";
              }
              form.reset();
              if (uploadStatus) uploadStatus.textContent = "";
            } else {
              const msg =
                "We received your intake, but couldn’t reach our inbox right now. If needed, please email us and reference your submission.";
              if (statusEl) statusEl.textContent = msg;
            }
          } catch (err){
            console.warn(err);
            const msg =
              "We received your intake, but your connection seems unstable. If you don’t hear back soon, please email us directly.";
            if (statusEl) statusEl.textContent = msg;
          } finally {
            if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = "Submit Organizing Intake"; }
          }
        }, true);
      });
    })();
  </script>

  <!-- Optional shared chat guard -->
  <script src="ftt-chat.js" defer></script>
</body>
</html>
