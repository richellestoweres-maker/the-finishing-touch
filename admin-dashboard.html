<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard – The Finishing Touch</title>

  <!-- Fonts & Site CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Manrope:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />

  <style>
    body{background:var(--paper,#fbf8f4)}
    .portal{width:min(1180px,94%);margin:24px auto 80px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background:#fff;padding:12px 16px;border-radius:14px;box-shadow:var(--shadow,0 10px 30px rgba(0,0,0,.08))
    }
    .brand-mini{display:flex;align-items:center;gap:.6rem}
    .brand-mini .vase-logo{width:28px;height:36px;background:url('logo-vase.png') center/contain no-repeat;display:inline-block}
    .rolepill{font-size:.8rem;padding:.2rem .6rem;border-radius:999px;border:1px solid #e3d9ce;background:#fffdfb}

    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .tabbtn{border:1px solid #e3d9ce;background:#fff;color:#2e2a27;border-radius:999px;padding:.55rem .9rem;font-weight:800;cursor:pointer}
    .tabbtn.active{background:var(--accent,#d2bda9);border-color:var(--accent,#d2bda9);color:#2a2624}

    .bar{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:12px}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .chip{white-space:nowrap;border:1px solid #e3d9ce;background:#fffdfb;color:#2e2a27;border-radius:999px;padding:.35rem .7rem;cursor:pointer;font-weight:700;font-size:.9rem}
    .chip.active{background:#2e2a27;color:#fff;border-color:#2e2a27}
    .search{display:flex;gap:8px}
    .search input{border:1px solid #e3d9ce;border-radius:10px;padding:.55rem .7rem}

    .panels{margin-top:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
    .card{background:#fff;border-radius:14px;box-shadow:var(--shadow,0 10px 30px rgba(0,0,0,.08));padding:14px;display:flex;flex-direction:column;gap:10px}
    .toprow{display:flex;justify-content:space-between;gap:8px;align-items:baseline}
    .meta{display:flex;gap:10px;flex-wrap:wrap;font-size:.92rem;opacity:.9}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{display:inline-block;padding:.55rem .85rem;border-radius:999px;font-weight:800;text-decoration:none;cursor:pointer}
    .btn-outline{border:1.5px solid #2e2a27;background:#fff;color:#2e2a27}
    .btn-solid{background:var(--accent,#d2bda9);color:#2a2624;border:0}
    .btn-danger{background:#7f1d1d;color:#fff;border:0}
    .empty{background:#fff;border:1px dashed #e3d9ce;border-radius:14px;padding:22px;text-align:center}

    .panel{display:none}
    .panel.active{display:block}

    /* Create Job form */
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .form-grid label{display:grid;gap:6px;font-weight:700}
    .form-grid input,.form-grid select,.form-grid textarea{border:1px solid #e3d9ce;border-radius:10px;padding:.6rem .7rem;background:#fffdfb}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .hint{font-size:.92rem;opacity:.9}
    .small{font-size:.9rem;opacity:.85}
  </style>
</head>
<body>
  <div class="portal">
    <!-- Top bar -->
    <div class="topbar">
      <div class="brand-mini">
        <span class="vase-logo" aria-hidden="true"></span>
        <div>
          <div style="font-family:'Playfair Display',serif;line-height:1;color:#2e2a27">The Finishing Touch</div>
          <div class="rolepill">Admin</div>
        </div>
      </div>
      <div class="row">
        <span id="whoami" class="small"></span>
        <a class="btn btn-outline" href="index.html">Home</a>
        <a class="btn btn-outline" href="contractor.html">Contractor view</a>
        <a id="signOutBtn" class="btn btn-outline" href="#">Sign out</a>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="Admin sections">
      <button class="tabbtn active" data-tab="open">Open Jobs</button>
      <button class="tabbtn" data-tab="all">All Jobs</button>
      <button class="tabbtn" data-tab="create">Create Job</button>
      <button class="tabbtn" data-tab="contractors">Contractors</button>
      <button class="tabbtn" data-tab="clients">Clients</button>
      <button class="tabbtn" data-tab="apps">Applications</button>
    </div>

    <!-- Filter/search -->
    <div class="bar">
      <div class="filters" id="filterChips" aria-label="Filter by service type"></div>
      <div class="search">
        <input id="searchBox" type="search" placeholder="Search jobs: zip, summary, notes…" />
        <button id="clearSearch" class="btn btn-outline" type="button">Clear</button>
      </div>
    </div>

    <!-- Panels -->
    <div class="panels">
      <!-- Open jobs -->
      <section id="panel-open" class="panel active" aria-live="polite">
        <div id="listOpen" class="grid"></div>
      </section>

      <!-- All jobs -->
      <section id="panel-all" class="panel" aria-live="polite">
        <div id="listAll" class="grid"></div>
      </section>

      <!-- Create job -->
      <section id="panel-create" class="panel">
        <form id="createForm" class="form-grid" autocomplete="off">
          <label>Service Type
            <select name="serviceType" required>
              <option value="cleaning">Cleaning</option>
              <option value="organizing">Organizing</option>
              <option value="decor">Decor</option>
              <option value="holiday">Holiday</option>
            </select>
          </label>
          <label>Status
            <select name="status">
              <option value="open">open</option>
              <option value="claimed">claimed</option>
              <option value="in_progress">in_progress</option>
              <option value="submitted">submitted</option>
              <option value="approved">approved</option>
              <option value="paid">paid</option>
            </select>
          </label>

          <label>Zip / Area <input name="zip" placeholder="77573" /></label>
          <label>Client UID (optional) <input name="clientId" placeholder="clients/{uid}" /></label>
          <label>Contractors Needed <input name="contractorsNeeded" type="number" min="1" value="1" required /></label>
          <label>Flat Rate (shown to client) <input name="flatRate" type="number" min="0" step="1" placeholder="275" /></label>
          <label>Team Hours (est) <input name="estimatedTeamHours" type="number" min="0" step=".5" placeholder="3.5" /></label>
          <label>Window / When <input name="window" placeholder="This Week, Fri 9–12, etc." /></label>
          <label>Summary <input name="summary" placeholder="3 bed / 2 bath - initial deep clean." /></label>
          <label style="grid-column:1/-1">Notes (internal)
            <textarea name="notes" rows="3" placeholder="entry codes, parking notes — keep PII out of top-level doc"></textarea>
          </label>

          <div style="grid-column:1/-1;display:flex;gap:10px;align-items:center">
            <button class="btn btn-solid" type="submit">Create Job</button>
            <span id="createMsg" class="hint"></span>
          </div>
        </form>
        <p class="hint" style="margin-top:10px">Reminder: put any sensitive client details inside <code>jobs/{id}/private/{doc}</code> after creating (admin-only).</p>
      </section>

      <!-- Contractors -->
      <section id="panel-contractors" class="panel" aria-live="polite">
        <div id="listContractors" class="grid"></div>
      </section>

      <!-- Clients -->
      <section id="panel-clients" class="panel" aria-live="polite">
        <div id="listClients" class="grid"></div>
      </section>

      <!-- Applications (pending) -->
      <section id="panel-apps" class="panel" aria-live="polite">
        <div id="listApps" class="grid"></div>
      </section>
    </div>
  </div>

  <script type="module">
    import { auth, db } from "./ft-firebase.js";
    import {
      onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import {
      collection, query, where, orderBy, onSnapshot, limit,
      doc, getDoc, getDocs, addDoc, setDoc, updateDoc, deleteDoc,
      serverTimestamp, runTransaction
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // ---------- Auth gate: only admins here ----------
    const whoami = document.getElementById('whoami');
    const btnOut = document.getElementById('signOutBtn');

    onAuthStateChanged(auth, async (user) => {
      if (!user) { location.href = "login.html?next=" + encodeURIComponent("admin-dashboard.html"); return; }
      whoami.textContent = user.email || user.uid;

      const roleSnap = await getDoc(doc(db, "users", user.uid));
      const role = (roleSnap.exists() ? (roleSnap.data().role || "") : "").toLowerCase();
      if (role !== "admin") {
        // Not an admin — send to contractor view (still useful)
        location.href = "contractor.html";
        return;
      }
      init();
    });

    btnOut.addEventListener('click', async (e) => {
      e.preventDefault(); await signOut(auth); location.href = "index.html";
    });

    // ---------- UI tabs / filters / search ----------
    const ALL_TYPES = ["cleaning","organizing","decor","holiday"];
    const chipsWrap = document.getElementById('filterChips');
    const searchBox = document.getElementById('searchBox');
    const clearSearch = document.getElementById('clearSearch');
    let activeType = "all";
    let searchTerm = "";

    function renderChips(){
      chipsWrap.innerHTML = "";
      ["all", ...ALL_TYPES].forEach(t => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "chip" + (t===activeType ? " active" : "");
        b.textContent = t==="all" ? "All" : (t[0].toUpperCase()+t.slice(1));
        b.addEventListener("click", () => { activeType = t; drawOpen(lastOpen); drawAll(lastAll); });
        chipsWrap.appendChild(b);
      });
    }

    // Switch panels
    const tabs = Array.from(document.querySelectorAll(".tabbtn"));
    const panels = Array.from(document.querySelectorAll(".panel"));
    function setTab(key){
      tabs.forEach(t => t.classList.toggle("active", t.dataset.tab===key));
      panels.forEach(p => p.classList.toggle("active", p.id === "panel-"+key));
    }
    tabs.forEach(t => t.addEventListener("click", () => setTab(t.dataset.tab)));

    searchBox.addEventListener("input", () => { searchTerm = searchBox.value.trim().toLowerCase(); drawOpen(lastOpen); drawAll(lastAll); });
    clearSearch.addEventListener("click", () => { searchBox.value=""; searchTerm=""; drawOpen(lastOpen); drawAll(lastAll); });

    // ---------- Live data ----------
    const elOpen = document.getElementById('listOpen');
    const elAll  = document.getElementById('listAll');
    const elCons = document.getElementById('listContractors');
    const elClients = document.getElementById('listClients');
    const elApps = document.getElementById('listApps');

    let unsubOpen=null, unsubAll=null, unsubCons=null, unsubClients=null, unsubApps=null;
    let lastOpen=[], lastAll=[];

    function init(){
      renderChips();

      // Open jobs
      unsubOpen = onSnapshot(
        query(collection(db,"jobs"), where("status","==","open"), orderBy("createdAt","desc")),
        snap => { lastOpen = snap.docs.map(d=>({id:d.id, ...d.data()})); drawOpen(lastOpen); }
      );

      // All jobs (limit to recent 200)
      unsubAll = onSnapshot(
        query(collection(db,"jobs"), orderBy("createdAt","desc"), limit(200)),
        snap => { lastAll = snap.docs.map(d=>({id:d.id, ...d.data()})); drawAll(lastAll); }
      );

      // Contractors (includes admins for assignment)
      unsubCons = onSnapshot(
        query(collection(db,"users"), where("role","in",["contractor","admin"])),
        snap => { drawPeople(elCons, snap.docs.map(d=>({id:d.id, ...d.data()})), "contractor"); }
      );
      // Clients
      unsubClients = onSnapshot(
        query(collection(db,"users"), where("role","==","client")),
        snap => { drawPeople(elClients, snap.docs.map(d=>({id:d.id, ...d.data()})), "client"); }
      );
      // Applications (pending)
      unsubApps = onSnapshot(
        query(collection(db,"users"), where("role","==","pending")),
        snap => { drawApps(snap.docs.map(d=>({id:d.id, ...d.data()}))); }
      );

      wireCreateForm();
    }

    // ---------- Render helpers ----------
    function cap(s){ return s ? (s[0].toUpperCase()+s.slice(1)) : ""; }
    function fmt(n){ return (n!=null && !isNaN(Number(n))) ? `$${Math.round(Number(n))}` : ""; }
    function matchFilters(j){
      const type = (j.serviceType||"").toLowerCase();
      const okType = (activeType==="all") || (type===activeType);
      if (!okType) return false;
      if (!searchTerm) return true;
      const hay = JSON.stringify(j).toLowerCase();
      return hay.includes(searchTerm);
    }
    function slots(j){
      const need = Number(j.contractorsNeeded || 1);
      const have = Array.isArray(j.contractorIds) ? j.contractorIds.length : (j.contractorId ? 1 : 0);
      const left = Math.max(0, need - have);
      return {need,have,left};
    }

    function jobCard(j){
      const {need, have, left} = slots(j);
      const when = j.window || "";
      const hours = j.estimatedTeamHours || j.teamHours || "";
      const zip = j.zip || j.area || j.city || "";
      const title = cap(j.serviceType||"job");
      const payLine = j.flatRate!=null ? `<span>Client est: <strong>${fmt(j.flatRate)}</strong></span>` : "";
      const leftTxt = need>1 ? `• ${left} of ${need} slots left` : "";

      return `
        <div class="card" data-id="${j.id}">
          <div class="toprow">
            <strong>${title}</strong>
            <span class="small">Status: <code>${j.status||''}</code></span>
          </div>
          <div class="meta">
            ${zip?`<span>📍 ${zip}</span>`:""}
            ${when?`<span>🗓️ ${when}</span>`:""}
            ${hours?`<span>⏱️ ${hours} hrs</span>`:""}
            ${leftTxt}
            ${payLine}
          </div>
          ${j.summary?`<div>${j.summary}</div>`:""}
          ${j.notes?`<div class="small" style="opacity:.8">${j.notes}</div>`:""}

          <div class="actions">
            <button class="btn btn-outline" data-act="assign-self">Assign me</button>
            <button class="btn btn-outline" data-act="assign-by-email">Assign by email</button>
            <button class="btn btn-outline" data-act="unassign">Unassign</button>
            <select class="btn" data-act="status">
              ${["open","claimed","in_progress","submitted","approved","paid"].map(s=>`<option value="${s}" ${j.status===s?"selected":""}>${s}</option>`).join("")}
            </select>
            <button class="btn btn-outline" data-act="private">Private note</button>
            <button class="btn btn-danger" data-act="delete">Delete</button>
          </div>
        </div>
      `;
    }

    function drawOpen(list){
      const filtered = list.filter(matchFilters);
      elOpen.innerHTML = filtered.length ? filtered.map(jobCard).join("") : `<div class="empty">No open jobs match.</div>`;
      hookJobActions(elOpen, filtered);
    }
    function drawAll(list){
      const filtered = list.filter(matchFilters);
      elAll.innerHTML = filtered.length ? filtered.map(jobCard).join("") : `<div class="empty">No jobs match.</div>`;
      hookJobActions(elAll, filtered);
    }

    function drawPeople(container, people, role){
      if (!people.length){ container.innerHTML = `<div class="empty">No ${role}s found.</div>`; return; }
      container.innerHTML = people.map(p=>`
        <div class="card">
          <div class="toprow">
            <strong>${p.displayName || p.email || p.id}</strong>
            <span class="rolepill">${p.role || ""}</span>
          </div>
          <div class="meta">
            ${p.email?`<span>📧 ${p.email}</span>`:""}
            ${Array.isArray(p.serviceTypes)&&p.serviceTypes.length?`<span>🧰 ${p.serviceTypes.join(", ")}</span>`:""}
          </div>
          ${role==="contractor"?`<div class="actions">
            <button class="btn btn-outline" data-uid="${p.id}" data-email="${p.email||""}" data-act="copy-id">Copy UID</button>
          </div>`:""}
        </div>
      `).join("");

      // Copy UID buttons
      container.querySelectorAll('[data-act="copy-id"]').forEach(b=>{
        b.addEventListener("click", async ()=>{
          try{ await navigator.clipboard.writeText(b.dataset.uid); b.textContent="Copied!"; setTimeout(()=>b.textContent="Copy UID",900);}catch{}
        });
      });
    }

    function drawApps(apps){
      if (!apps.length){ elApps.innerHTML = `<div class="empty">No pending applications.</div>`; return; }
      elApps.innerHTML = apps.map(a=>`
        <div class="card">
          <div class="toprow">
            <strong>${a.displayName || a.email || a.id}</strong>
            <span class="rolepill">pending</span>
          </div>
          <div class="meta">
            ${a.email?`<span>📧 ${a.email}</span>`:""}
            ${Array.isArray(a.serviceTypes)&&a.serviceTypes.length?`<span>🧰 ${a.serviceTypes.join(", ")}</span>`:""}
          </div>
          <div class="actions">
            <button class="btn btn-solid" data-act="approve" data-uid="${a.id}">Approve → contractor</button>
            <button class="btn btn-outline" data-act="reject" data-uid="${a.id}">Reject</button>
          </div>
        </div>
      `).join("");

      elApps.querySelectorAll('[data-act="approve"]').forEach(b=>{
        b.addEventListener("click", async ()=>{
          try{
            await updateDoc(doc(db,"users",b.dataset.uid), { role:"contractor", updatedAt: serverTimestamp() });
            alert("Approved.");
          }catch(e){ alert("Could not approve."); console.warn(e); }
        });
      });
      elApps.querySelectorAll('[data-act="reject"]').forEach(b=>{
        b.addEventListener("click", async ()=>{
          try{
            await updateDoc(doc(db,"users",b.dataset.uid), { role:"rejected", updatedAt: serverTimestamp() });
            alert("Rejected.");
          }catch(e){ alert("Could not reject."); console.warn(e); }
        });
      });
    }

    // ---------- Job actions (admin) ----------
    function hookJobActions(container, jobs){
      const byId = new Map(jobs.map(j=>[j.id,j]));
      container.querySelectorAll(".card .actions").forEach(row=>{
        const id = row.closest(".card").dataset.id;
        const job = byId.get(id);
        if (!job) return;

        row.querySelector('[data-act="assign-self"]')?.addEventListener("click", ()=>assignSelf(id));
        row.querySelector('[data-act="assign-by-email"]')?.addEventListener("click", ()=>assignByEmail(id));
        row.querySelector('[data-act="unassign"]')?.addEventListener("click", ()=>unassign(id));
        row.querySelector('[data-act="private"]')?.addEventListener("click", ()=>editPrivate(id));
        row.querySelector('[data-act="delete"]')?.addEventListener("click", ()=>delJob(id));
        row.querySelector('[data-act="status"]')?.addEventListener("change", (e)=>setStatus(id, e.target.value));
      });
    }

    async function assignSelf(jobId){
      const me = auth.currentUser; if (!me) return;
      try{
        await runTransaction(db, async tx=>{
          const ref=doc(db,"jobs",jobId), snap=await tx.get(ref);
          if (!snap.exists()) throw "Missing";
          const j=snap.data();
          const need=Number(j.contractorsNeeded||1);
          const ids=Array.isArray(j.contractorIds)?[...j.contractorIds]:[];
          if (!ids.includes(me.uid)) ids.push(me.uid);
          const update = {
            contractorIds: ids,
            updatedAt: serverTimestamp(),
            status: (ids.length>=need) ? "claimed" : "open",
            claimedAt: (ids.length>=need) ? serverTimestamp() : j.claimedAt || null
          };
          tx.update(ref, update);
        });
        alert("Assigned.");
      }catch(e){ alert("Could not assign."); console.warn(e); }
    }

    async function assignByEmail(jobId){
      const email = prompt("Enter contractor email to assign:");
      if (!email) return;
      try{
        // Look up user by email (simple query)
        const q = query(collection(db,"users"), where("email","==", email));
        const snap = await getDocs(q);
        if (snap.empty){ alert("No user with that email."); return; }
        const u = { id: snap.docs[0].id, ...snap.docs[0].data() };
        if ((u.role||"").toLowerCase()==="pending"){ alert("User is still pending; approve first."); return; }

        await runTransaction(db, async tx=>{
          const ref=doc(db,"jobs",jobId), ds=await tx.get(ref);
          if (!ds.exists()) throw "Missing";
          const j=ds.data();
          const need=Number(j.contractorsNeeded||1);
          const ids=Array.isArray(j.contractorIds)?[...j.contractorIds]:[];
          if (!ids.includes(u.id)) ids.push(u.id);
          const update = {
            contractorIds: ids,
            updatedAt: serverTimestamp(),
            status: (ids.length>=need) ? "claimed" : "open",
            claimedAt: (ids.length>=need) ? serverTimestamp() : j.claimedAt || null
          };
          tx.update(ref, update);
        });
        alert("Assigned.");
      }catch(e){ alert("Could not assign."); console.warn(e); }
    }

    async function unassign(jobId){
      const who = prompt("Remove which contractor UID? (leave blank to remove the last one)");
      try{
        await runTransaction(db, async tx=>{
          const ref=doc(db,"jobs",jobId), ds=await tx.get(ref);
          if (!ds.exists()) throw "Missing";
          const j=ds.data();
          let ids=Array.isArray(j.contractorIds)?[...j.contractorIds]:[];
          if (!ids.length) return;
          if (who){ ids = ids.filter(x=>x!==who); }
          else { ids.pop(); }
          tx.update(ref, {
            contractorIds: ids,
            updatedAt: serverTimestamp(),
            status: ids.length ? (j.status||"claimed") : "open"
          });
        });
        alert("Unassigned.");
      }catch(e){ alert("Could not unassign."); console.warn(e); }
    }

    async function setStatus(jobId, status){
      try{
        await updateDoc(doc(db,"jobs",jobId), { status, updatedAt: serverTimestamp() });
      }catch(e){ alert("Could not update status."); console.warn(e); }
    }

    async function delJob(jobId){
      if (!confirm("Delete this job?")) return;
      try{ await deleteDoc(doc(db,"jobs",jobId)); }catch(e){ alert("Could not delete."); console.warn(e); }
    }

    // Minimal private note doc editor (single doc named "main")
    async function editPrivate(jobId){
      const note = prompt("Private note (replaces jobs/{id}/private/main.note). Leave blank to clear.");
      try{
        const ref = doc(db, "jobs", jobId, "private", "main");
        if (!note){ await setDoc(ref, { note:"", updatedAt: serverTimestamp() }); }
        else { await setDoc(ref, { note, updatedAt: serverTimestamp() }); }
        alert("Saved.");
      }catch(e){ alert("Could not save private note."); console.warn(e); }
    }

    // ---------- Create job ----------
    function wireCreateForm(){
      const form = document.getElementById('createForm');
      const msg  = document.getElementById('createMsg');

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        msg.textContent = "Creating…";

        const fd = new FormData(form);
        const data = Object.fromEntries(fd.entries());

        // Normalize fields
        const job = {
          serviceType: (data.serviceType||"").toLowerCase(),
          status: (data.status||"open"),
          zip: (data.zip||"").trim(),
          area: (data.area||"").trim(),
          window: (data.window||"").trim(),
          summary: (data.summary||"").trim(),
          notes: (data.notes||"").trim(),
          flatRate: data.flatRate? Number(data.flatRate) : null,
          estimatedTeamHours: data.estimatedTeamHours? Number(data.estimatedTeamHours) : null,
          contractorsNeeded: Math.max(1, Number(data.contractorsNeeded||1)),
          contractorIds: [],
          clientId: (data.clientId||"").trim(),
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        };
        // remove empty strings/nulls where appropriate
        if (!job.zip) delete job.zip;
        if (!job.area) delete job.area;
        if (!job.window) delete job.window;
        if (!job.summary) delete job.summary;
        if (!job.notes) delete job.notes;
        if (!job.clientId) delete job.clientId;
        if (job.flatRate==null) delete job.flatRate;
        if (job.estimatedTeamHours==null) delete job.estimatedTeamHours;

        try{
          await addDoc(collection(db,"jobs"), job);
          msg.textContent = "Created ✔";
          form.reset();
          setTimeout(()=>msg.textContent="",1200);
          setTab("open");
        }catch(e){
          msg.textContent = "Could not create job.";
          console.warn(e);
        }
      });
    }
  </script>
</body>
</html>
