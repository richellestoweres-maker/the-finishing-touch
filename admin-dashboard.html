function wireAdminHelp(){
  const launcher = document.getElementById('admin-help-launcher');
  const panel = document.getElementById('admin-help');
  const thread = document.getElementById('ah-thread');
  const input = document.getElementById('ah-input');
  const send = document.getElementById('ah-send');
  const close = document.querySelector('#admin-help .ah-close');
  const quick = document.querySelector('#admin-help .ah-quick');

  const bookUrl = "https://book.squareup.com/appointments/kbcbv6uu1d7qd7/location/L2P303Y0SXTD9";

  function addMsg(html, who="bot"){
    const b=document.createElement("div");
    b.className=`ah-bubble ${who}`; b.innerHTML=html;
    thread.appendChild(b); thread.scrollTop=thread.scrollHeight;
  }
  function greet(){
    addMsg("Hi! Admin helper here. Ask about quoting, statuses, assigning, booking links — or type a holiday like <em>Game Day</em>, <em>Birthday</em>, or <em>Christmas</em> to see which fields to fill in.");
  }

  function detectIntent(t){
    t=(t||"").toLowerCase();
    if (/\b(game\s*day|gameday|super ?bowl|football|sports)\b/.test(t)) return "gameday";
    if (/\b(birthday|bday)\b/.test(t)) return "birthday";
    if (/\b(christmas|xmas)\b/.test(t)) return "christmas";
    if (/\b(holiday|event|which fields|holiday cheat|help.*holiday)\b/.test(t)) return "holiday";
    if (/quote|estimate|price|how do i quote/.test(t)) return "quote";
    if (/organizing|closet|pantry|garage/.test(t)) return "organizing";
    if (/assign|unassign|add.*contractor/.test(t)) return "assign";
    if (/status|submitted|approved|paid|claimed/.test(t)) return "status";
    if (/book|calendar|square/.test(t)) return "booking";
    return "fallback";
  }

  function answer(intent){
    const booking = `Send the calendar: <a href="${bookUrl}" target="_blank" rel="noopener">Open Square</a>.`;
    const estTab = `Use the <strong>Estimate</strong> tab for a fast ballpark (no saving).`;

    const GAME_DAY = [
      "<strong>Game Day (Holiday/Event):</strong>",
      "Holiday/Event = <strong>Game Day</strong>",
      "Set: <em>Tablescapes</em> (coffee table, console, food bar), <em>Garland</em> (entry/TV wall), <em>Wreaths</em> if any.",
      "<strong>No trees.</strong>"
    ].join("<br>");

    const BIRTHDAY = [
      "<strong>Birthday (Holiday/Event):</strong>",
      "Holiday/Event = <strong>Birthday</strong>",
      "Use: <em>Tablescapes</em> (cake/gift table), <em>Garland</em>, <em>Mantle</em> if used.",
      "<strong>No trees.</strong>"
    ].join("<br>");

    const CHRISTMAS = [
      "<strong>Christmas (Holiday/Event):</strong>",
      "Holiday/Event = <strong>Christmas</strong>",
      "Set: <strong># Trees + Tallest Size + Style</strong> (add <em>Ribbon</em> if used).",
      "Then add: <em>Wreaths</em> / <em>Garland</em> / <em>Stairs</em> / <em>Mantle</em> / <em>Tablescapes</em>."
    ].join("<br>");

    switch(intent){
      case "gameday":   return GAME_DAY;
      case "birthday":  return BIRTHDAY;
      case "christmas": return CHRISTMAS;
      case "holiday":
        return [
          "<strong>Holiday/Event cheat sheet</strong>",
          GAME_DAY, "", BIRTHDAY, "", CHRISTMAS,
          "<span class='small' style='opacity:.8'>Tip: Storage (Attic/Offsite) + Shopping Trips add time; optional Teardown quotes its own hours + $.</span>"
        ].join("<br>");
      case "quote":
        return [
          estTab,
          "• Cleaning: size/service, beds/baths, add-ons → time hint.",
          "• Organizing: area/size + clutter/decision → time hint.",
          "• Decor/Holiday: pick elements; Christmas unlocks tree fields.",
          booking
        ].join("<br>");
      case "organizing":
        return [
          "Organizing defaults: Medium area ≈ 3–4 hr team block.",
          "Heavier clutter / slower decisions increase hours; bins/labels add a bit.",
          estTab
        ].join("<br>");
      case "assign":
        return [
          "Open/All Jobs → card actions:",
          "• <strong>Assign me</strong> adds you.",
          "• <strong>Assign by email</strong> finds user by email and adds them.",
          "• <strong>Unassign</strong> removes a UID.",
          "Status flips to <em>claimed</em> when all slots are filled."
        ].join("<br>");
      case "status":
        return [
          "<code>open → claimed → in_progress → submitted → approved → paid</code>",
          "Contractors progress jobs; you can override with the dropdown.",
          "Use <em>Private note</em> for entry codes/PII."
        ].join("<br>");
      case "booking":
        return booking;
      default:
        return "Try: “Game Day fields”, “Birthday fields”, “Christmas fields”, or “Holiday cheat sheet”. Also: “How do I quote?”, “Assign a job”, “Statuses”, “Booking link”.";
    }
  }

  function sendText(txt){
    const t = (txt||"").trim(); if(!t) return;
    addMsg(t, "me");
    setTimeout(()=> addMsg(answer(detectIntent(t))), 120);
  }

  launcher.addEventListener('click', ()=>{
    panel.style.display = 'block';
    if (!thread.dataset.greeted){ greet(); thread.dataset.greeted="1"; }
    input.focus();
  });
  close.addEventListener('click', ()=> panel.style.display='none');
  send.addEventListener('click', ()=>{ sendText(input.value); input.value=""; });
  input.addEventListener('keydown', (e)=>{ if(e.key==="Enter"){ e.preventDefault(); sendText(input.value); input.value=""; }});
  quick.addEventListener('click', (e)=>{
    if (!e.target.matches('button[data-q]')) return;
    const q = e.target.getAttribute('data-q');
    addMsg(e.target.textContent, "me");
    setTimeout(()=> addMsg(answer(detectIntent(q))), 120);
  });
}


